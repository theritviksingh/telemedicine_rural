<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Dashboard - Telemedicine Rural Nabha</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #f1f8e9 100%); }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .feature-card { background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); }
        
        /* Google Translate Widget Styling */
        .google-translate-container {
            display: inline-block;
        }

        .google-translate-container select {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            color: #374151;
            outline: none;
            transition: border-color 0.2s;
        }

        .google-translate-container select:hover {
            border-color: #3b82f6;
        }

        .google-translate-container select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Hide Google Translate banner */
        .goog-te-banner-frame {
            display: none !important;
        }

        body {
            top: 0 !important;
        }

        .goog-te-menu-value span:first-child {
            display: none;
        }

        .goog-te-menu-value:before {
            content: 'Translate';
            color: #374151;
        }

        .goog-te-menu-frame {
            border-radius: 0.5rem !important;
            border: 1px solid #e2e8f0 !important;
            z-index: 999999 !important;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
            max-height: 200px !important;
            overflow-y: auto !important;
        }
        
        .goog-te-menu-frame .goog-te-menu2 {
            background: white !important;
            border-radius: 0.5rem !important;
        }
        
        /* Fix z-index issues with navbar and Google Translate */
        nav {
            position: relative !important;
            z-index: 10002 !important;
        }
        
        /* Fix Google Translate widget positioning */
        #google_translate_element {
            position: relative !important;
            z-index: 10001 !important;
        }
        
        /* Prevent Google Translate from affecting navbar layout */
        .goog-te-gadget {
            font-size: 0 !important;
            line-height: 0 !important;
        }
        
        .goog-te-gadget > span {
            vertical-align: top !important;
        }
        
        .goog-te-gadget .goog-te-combo {
            margin: 0 !important;
            vertical-align: top !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Top Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 flex items-center">
                    <svg class="h-8 w-8 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    <span class="text-xl font-bold text-gray-900">Telemedicine Rural Nabha</span>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Google Translate Widget -->
                    <div class="google-translate-container">
                        <div id="google_translate_element"></div>
                    </div>
                    
                    <!-- Profile -->
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-600 rounded-full w-8 h-8 flex items-center justify-center">
                            <a href="/profile"><span class="text-white font-semibold text-sm notranslate">{{ user.name.split()[0][0] if user.name.split() else '' }}{{ user.name.split()[-1][0] if user.name.split()|length > 1 else '' }}</span></a>
                        </div>
                        <div class="hidden md:block">
                            <a href="/profile"><p class="text-sm font-medium text-gray-900 notranslate">{{ user.username }}</p></a>
                        </div>
                    </div>

                    <!-- Logout -->
                    <a href="/logout" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm font-medium">
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome back, <span class="notranslate">{{ user.name }}</span>! üíä</h1>
            <p class="text-gray-600">Manage your medicine inventory and serve your community - ‡§¶‡§µ‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</p>
        </div>

<h3 class="text-xl font-semibold mb-4">Medicine Inventory Management</h3>

<!-- Add New Medicine Form -->
<div class="bg-white p-6 rounded-lg shadow-md mb-6">
    <h4 class="text-lg font-medium mb-4">Add New Medicine</h4>
    <form id="addMedicineForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
            <label for="medicineName" class="block text-sm font-medium text-gray-700 mb-1">Medicine Name</label>
            <input type="text" id="medicineName" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
            <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity Available</label>
            <input type="number" id="quantity" name="quantity" min="1" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex items-end">
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition duration-200">Add Medicine</button>
        </div>
    </form>
</div>

<div id="message" class="mb-4"></div>

<!-- Medicine List -->
<div class="bg-white p-6 rounded-lg shadow-md">
    <h4 class="text-lg font-medium mb-4">Your Medicine Inventory</h4>
    <div id="medicineList">
        <!-- Medicines will be loaded here -->
    </div>
</div>



<script>
document.addEventListener('DOMContentLoaded', function() {
    loadMedicines();
});

document.getElementById('addMedicineForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const messageDiv = document.getElementById('message');
    
    fetch('/add_medicine', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            messageDiv.innerHTML = '<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">Medicine added successfully!</div>';
            this.reset();
            loadMedicines();
        } else {
            messageDiv.innerHTML = '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">' + data.error + '</div>';
        }
    })
    .catch(error => {
        messageDiv.innerHTML = '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">An error occurred. Please try again.</div>';
    });
});

function loadMedicines() {
    fetch('/get_pharmacy_medicines')
    .then(response => response.json())
    .then(data => {
        const medicineList = document.getElementById('medicineList');
        if (data.length === 0) {
            medicineList.innerHTML = '<p class="text-gray-500">No medicines added yet.</p>';
            return;
        }
        
        let html = '<div class="overflow-x-auto"><table class="min-w-full table-auto"><thead><tr class="bg-gray-50"><th class="px-4 py-2 text-left">Medicine Name</th><th class="px-4 py-2 text-left">Quantity</th><th class="px-4 py-2 text-left">Added Date</th><th class="px-4 py-2 text-left">Actions</th></tr></thead><tbody>';
        
        data.forEach(medicine => {
            html += `
                <tr class="border-t">
                    <td class="px-4 py-2">${medicine.name}</td>
                    <td class="px-4 py-2">
                        <span id="qty-${medicine.id}">${medicine.quantity}</span>
                        <input type="number" id="edit-qty-${medicine.id}" value="${medicine.quantity}" min="1" class="hidden w-20 px-2 py-1 border rounded">
                    </td>
                    <td class="px-4 py-2">${new Date(medicine.added_date).toLocaleDateString()}</td>
                    <td class="px-4 py-2 space-x-2">
                        <button onclick="editMedicine(${medicine.id})" id="edit-btn-${medicine.id}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm">Edit</button>
                        <button onclick="saveEdit(${medicine.id})" id="save-btn-${medicine.id}" class="hidden bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">Save</button>
                        <button onclick="cancelEdit(${medicine.id})" id="cancel-btn-${medicine.id}" class="hidden bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">Cancel</button>
                        <button onclick="deleteMedicine(${medicine.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">Delete</button>
                    </td>
                </tr>
            `;
        });
        
        html += '</tbody></table></div>';
        medicineList.innerHTML = html;
    })
    .catch(error => {
        document.getElementById('medicineList').innerHTML = '<p class="text-red-500">Error loading medicines.</p>';
    });
}

function editMedicine(id) {
    document.getElementById(`qty-${id}`).classList.add('hidden');
    document.getElementById(`edit-qty-${id}`).classList.remove('hidden');
    document.getElementById(`edit-btn-${id}`).classList.add('hidden');
    document.getElementById(`save-btn-${id}`).classList.remove('hidden');
    document.getElementById(`cancel-btn-${id}`).classList.remove('hidden');
}

function saveEdit(id) {
    const newQuantity = document.getElementById(`edit-qty-${id}`).value;
    
    fetch(`/update_medicine/${id}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ quantity: parseInt(newQuantity) })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadMedicines();
        } else {
            alert('Error updating medicine: ' + data.error);
        }
    })
    .catch(error => {
        alert('Error updating medicine');
    });
}

function cancelEdit(id) {
    document.getElementById(`qty-${id}`).classList.remove('hidden');
    document.getElementById(`edit-qty-${id}`).classList.add('hidden');
    document.getElementById(`edit-btn-${id}`).classList.remove('hidden');
    document.getElementById(`save-btn-${id}`).classList.add('hidden');
    document.getElementById(`cancel-btn-${id}`).classList.add('hidden');
    document.getElementById(`edit-qty-${id}`).value = document.getElementById(`qty-${id}`).textContent;
}

function deleteMedicine(id) {
    if (confirm('Are you sure you want to delete this medicine?')) {
        fetch(`/delete_medicine/${id}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadMedicines();
            } else {
                alert('Error deleting medicine: ' + data.error);
            }
        })
        .catch(error => {
            alert('Error deleting medicine');
        });
    }
}
</script>

    <!-- Footer -->
    <footer class="bg-white border-t mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <div class="flex justify-center items-center mb-4">
                    <svg class="h-6 w-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    <span class="text-lg font-semibold text-gray-900">Telemedicine Rural Nabha</span>
                </div>
                <p class="text-gray-600 text-sm mb-2">Empowering rural healthcare through technology - ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§ï‡•ã ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§∏‡§∂‡§ï‡•ç‡§§ ‡§¨‡§®‡§æ‡§®‡§æ</p>
                <p class="text-gray-500 text-xs">¬© 2024 Telemedicine Rural Nabha. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Google Translate Script -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement(
                {
                    pageLanguage: 'en',
                    includedLanguages: 'hi,pa,en,ur,bn,ta,te,ml,kn,gu,mr,or,as,ne',
                    layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                    autoDisplay: false
                }, 
                'google_translate_element'
            );
            
            // Restore saved language preference
            setTimeout(function() {
                restoreSelectedLanguage();
                monitorLanguageChanges();
            }, 1000);
        }

        function saveSelectedLanguage() {
            var selectElement = document.querySelector('.goog-te-combo');
            if (selectElement && selectElement.value) {
                localStorage.setItem('googtrans', '/en/' + selectElement.value);
                localStorage.setItem('selectedLanguage', selectElement.value);
                console.log('Language saved:', selectElement.value);
            }
        }

        function restoreSelectedLanguage() {
            var savedLanguage = localStorage.getItem('selectedLanguage');
            var selectElement = document.querySelector('.goog-te-combo');
            
            if (savedLanguage && selectElement) {
                selectElement.value = savedLanguage;
                selectElement.dispatchEvent(new Event('change'));
                console.log('Language restored:', savedLanguage);
            }
        }

        function monitorLanguageChanges() {
            var selectElement = document.querySelector('.goog-te-combo');
            if (selectElement) {
                selectElement.addEventListener('change', function() {
                    saveSelectedLanguage();
                });
            }
        }

        // Hide Google Translate banner
        function hideGoogleTranslateBanner() {
            var banner = document.querySelector('.goog-te-banner-frame');
            if (banner) {
                banner.style.display = 'none';
            }
            document.body.style.top = '0px';
        }

        // Check for banner periodically
        setInterval(hideGoogleTranslateBanner, 100);
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</div></body></html>